[
  {
    "objectID": "Final_project.html",
    "href": "Final_project.html",
    "title": "Final project",
    "section": "",
    "text": "Yishan Lin: JHED ID: ylin183; Email: ylin183@jh.edu\nYingqi Wang: JHED ID: ywang911; Email: ywang911@jh.edu\nYiming Ding: JHED ID: yding75; Email: yding75@jh.edu\nRuiqing Cai: JHED ID: rcai9; Email: rcai9@jh.edu"
  },
  {
    "objectID": "Final_project.html#authors-information",
    "href": "Final_project.html#authors-information",
    "title": "Final project",
    "section": "",
    "text": "Yishan Lin: JHED ID: ylin183; Email: ylin183@jh.edu\nYingqi Wang: JHED ID: ywang911; Email: ywang911@jh.edu\nYiming Ding: JHED ID: yding75; Email: yding75@jh.edu\nRuiqing Cai: JHED ID: rcai9; Email: rcai9@jh.edu"
  },
  {
    "objectID": "Final_project.html#data-preparation-and-robust-analysis",
    "href": "Final_project.html#data-preparation-and-robust-analysis",
    "title": "Final project",
    "section": "1. Data Preparation and Robust Analysis",
    "text": "1. Data Preparation and Robust Analysis\n\n\n\n\n\n\nNote\n\n\n\nIn this section, data downloading, processing, and some initial analysis were conducted by using the “functional Programming” Paradigms\n\n\n\n1.1 Download and Initial Cleaning\nData are directly downloaded from the CDC websites. For more information see the code\n\n\nCode\n# Create a folder to store all the data\nif (!dir.exists(\"data\")) { # check if folder already exists\n  dir.create(\"data\")\n}\n\n# Setup function to download the data\ndownload_and_save &lt;- function(url, filename) {\n  filepath &lt;- file.path(\"data\", filename)\n  \n  if (!file.exists(filepath)) { # Check if file already exists\n    message(paste(\"Downloading\", filename, \"...\"))\n    dataset &lt;- read_xpt(url)\n    saveRDS(dataset, filepath)\n  } else {\n    message(paste(filename, \"already exists. Loading from cache.\"))\n  }\n  \n  readRDS(filepath) # Load the dataset\n}\n \n# Function to clean individual datasets\nclean_dataset &lt;- function(data, vars) {\n  data %&gt;% dplyr::select(all_of(vars))\n}\n\n# Selecting data\ndatasets &lt;- list(\n  demo = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DEMO_L.xpt\",\n    file = \"demo_data.rds\",\n    vars = c(\"SEQN\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\")\n  ),\n  diet = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DR1TOT_L.xpt\",\n    file = \"diet_data.rds\",\n    vars = c(\"SEQN\", \"DR1TSODI\", \"DR1TKCAL\")\n  ),\n  bp = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BPXO_L.xpt\",\n    file = \"bp_data.rds\",\n    vars = c(\"SEQN\", \"BPXOSY1\", \"BPXOSY2\", \"BPXOSY3\", \"BPXODI1\", \"BPXODI2\", \"BPXODI3\")\n  ),\n  body = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BMX_L.xpt\",\n    file = \"body_data.rds\",\n    vars = c(\"SEQN\", \"BMXBMI\")\n  ),\n  lab = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/TCHOL_L.xpt\",\n    file = \"lab_data.rds\",\n    vars = c(\"SEQN\", \"LBXTC\")\n  ),\n  ques = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BPQ_L.xpt\",\n    file = \"ques_data.rds\",\n    vars = c(\"SEQN\", \"BPQ150\")\n  )\n)\n\n# Downloading, saving, and cleaning datasets\nnhanes_data &lt;- purrr::map(datasets, function(info) {\n  raw_data &lt;- download_and_save(info$url, info$file)\n  clean_dataset(raw_data, info$vars)\n})\n\n# Merging into single dataframe\nmerged_data &lt;- purrr::reduce(nhanes_data, dplyr::left_join, by = \"SEQN\")\n\n\n\n\n1.2 Process and Table 1\nTable 1: Characteristics of Study Participants from August 2021 to August 2023\n\n\nCode\n# Function to preprocess data\nprocess_data &lt;- function(data) {\n  data %&gt;%\n    dplyr::mutate(\n      RIAGENDR = dplyr::recode_factor(RIAGENDR, `1` = \"Male\", `2` = \"Female\"),\n      RIDRETH3 = dplyr::recode_factor(\n        RIDRETH3,\n        `1` = \"Mexican American\",\n        `2` = \"Other Hispanic\",\n        `3` = \"Non-Hispanic White\",\n        `4` = \"Non-Hispanic Black\",\n        `6` = \"Other\"\n      ),\n      BPQ150 = dplyr::recode_factor(BPQ150, `1` = \"Yes\", `2` = \"No\"),\n      sybp = rowMeans(dplyr::select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),\n      dibp = rowMeans(dplyr::select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)\n    )\n}\n\n# Create Table 1 function\ncreate_table1 &lt;- function(data) {\n  table1(~ RIDAGEYR + RIAGENDR + RIDRETH3 + DR1TSODI + BMXBMI + sybp + dibp + \n           BPQ150, data = data)\n}\n\n# Labeling data\nset_labels_and_units &lt;- function(data, labels, units = NULL) {\n  for (var in names(labels)) {\n    label(data[[var]]) &lt;- labels[[var]]\n  }\n  if (!is.null(units)) {\n    for (var in names(units)) {\n      units(data[[var]]) &lt;- units[[var]]\n    }\n  }\n  return(data)\n}\n\n## Define labels and units as named lists\nlabels &lt;- list(\n  RIDAGEYR = \"Age at Screening\",\n  RIAGENDR = \"Gender\",\n  RIDRETH3 = \"Race\",\n  BPQ150 = \"High Blood Pressure Medication\",\n  sybp = \"Systolic Blood Pressure\",\n  dibp = \"Diastolic Blood Pressure\",\n  BMXBMI = \"Body Mass Index\"\n)\n\nunits &lt;- list(\n  RIDAGEYR = \"Year\",\n  sybp = \"mmHg\",\n  dibp = \"mmHg\",\n  BMXBMI = \"kg/m\\u00B2\"\n)\n\n# Apply the data processing function\ncleaned_data &lt;- process_data(merged_data)\n\n# Apply labels and units\ncleaned_data &lt;- set_labels_and_units(cleaned_data, labels, units)\n\n# Generate Table 1\ncreate_table1(cleaned_data)\n\n\n\n\n\n\n\n\n\n\n\nOverall\n(N=11933)\n\n\n\n\nAge at Screening (Year)\n\n\n\nMean (SD)\n38.3 (25.6)\n\n\nMedian [Min, Max]\n37.0 [0, 80.0]\n\n\nGender\n\n\n\nMale\n5575 (46.7%)\n\n\nFemale\n6358 (53.3%)\n\n\nRace\n\n\n\nMexican American\n1117 (9.4%)\n\n\nOther Hispanic\n1373 (11.5%)\n\n\nNon-Hispanic White\n6217 (52.1%)\n\n\nNon-Hispanic Black\n1597 (13.4%)\n\n\nOther\n681 (5.7%)\n\n\nMissing\n948 (7.9%)\n\n\nSodium (mg)\n\n\n\nMean (SD)\n2940 (1610)\n\n\nMedian [Min, Max]\n2660 [0, 20000]\n\n\nMissing\n5239 (43.9%)\n\n\nBody Mass Index (kg/m²)\n\n\n\nMean (SD)\n27.2 (8.14)\n\n\nMedian [Min, Max]\n26.4 [11.1, 74.8]\n\n\nMissing\n3462 (29.0%)\n\n\nSystolic Blood Pressure (mmHg)\n\n\n\nMean (SD)\n119 (18.2)\n\n\nMedian [Min, Max]\n116 [70.0, 232]\n\n\nMissing\n4415 (37.0%)\n\n\nDiastolic Blood Pressure (mmHg)\n\n\n\nMean (SD)\n72.2 (11.5)\n\n\nMedian [Min, Max]\n71.7 [34.0, 139]\n\n\nMissing\n4415 (37.0%)\n\n\nHigh Blood Pressure Medication\n\n\n\nYes\n2442 (20.5%)\n\n\nNo\n523 (4.4%)\n\n\nMissing\n8968 (75.2%)\n\n\n\n\n\n\n\nCode\n# Save cleaned data\nreadr::write_csv(cleaned_data, \"data/NHANES_cleaned_data.csv\")\n\n\n\n\n1.3 Robust Anlysis\nA stratified Analysis by gender was conducted.\n\n\nCode\n# Stratification function setup\nstratified_analysis &lt;- function(data, group_var, analysis_func) {\n  # Split data into groups\n  split_data &lt;- split(data, data[[group_var]])\n  \n  # Apply the analysis function and add group label\n  summary_list &lt;- map(split_data, ~ {\n    analysis_func(.x) %&gt;%\n      mutate(Gender = unique(.x[[group_var]])) # Add group label\n  })\n  \n  # Combine all group summaries into a single table\n  combined_summary &lt;- bind_rows(summary_list)\n  \n  # Return combined table\n  combined_summary\n}\n\nsummarize_data &lt;- function(data) {\n  data %&gt;%\n    summarize(\n      mean_age = mean(RIDAGEYR, na.rm = TRUE),\n      mean_sodium = mean(DR1TSODI, na.rm = TRUE),\n      mean_sbp = mean(sybp, na.rm = TRUE),\n      mean_dbp = mean(dibp, na.rm = TRUE),\n      n = n()\n    )\n}\n\n# stratified analysis by gender\nstratified_summary &lt;- stratified_analysis(cleaned_data, \"RIAGENDR\", summarize_data)\nknitr::kable(stratified_summary, \n      caption = \"Table 2: Summary of each variables stratified by gender\", \n      format = \"html\")\n\n\n\nTable 2: Summary of each variables stratified by gender\n\n\nmean_age\nmean_sodium\nmean_sbp\nmean_dbp\nn\nGender\n\n\n\n\n37.12323\n3336.134\n121.2114\n72.55017\n5575\nMale\n\n\n39.36537\n2615.691\n117.2749\n71.91256\n6358\nFemale"
  },
  {
    "objectID": "Dashboard.html",
    "href": "Dashboard.html",
    "title": "Histograms",
    "section": "",
    "text": "Code\n# load data from the project\nlibrary(here)\n\n\nhere() starts at C:/Users/Cai13/OneDrive - Johns Hopkins/Statistical Programming Paradigms and Workflows/Projects/Project 4/project4-journey-to-the-west/Final project\n\n\nCode\nlibrary(shiny)\n\n\nWarning: package 'shiny' was built under R version 4.4.2\n\n\nCode\nlibrary(flexdashboard)\n\n\nWarning: package 'flexdashboard' was built under R version 4.4.2\n\n\nCode\nload(here(\"data.RData\"))"
  },
  {
    "objectID": "Dashboard.html#column",
    "href": "Dashboard.html#column",
    "title": "Histograms",
    "section": "Column",
    "text": "Column\nData from NHANES(2021-2023)\n\n\nCode\ntextInput(\"name\", \"What is the title of the graph?\")\n\n\n\nWhat is the title of the graph?\n\n\n\n\nCode\nselectInput(\"variable\", label = \"Which variable:\",\n            choices = c(\"Please select\",\"Sodium intake\", \"Systolic Blood Pressure\", \"Diastolic Blood Pressure\"), selected = \"Please select\")\n\n\n\nWhich variable:\n\nPlease select\nSodium intake\nSystolic Blood Pressure\nDiastolic Blood Pressure\n\n\n\n\n\nCode\nselectInput(\"n_breaks\", label = \"Number of bins:\",\n            choices = c(10, 20, 30), selected = 20)\n\n\n\nNumber of bins:\n\n10\n20\n30\n\n\n\n\n\nCode\ncheckboxInput(\"density\", \"show density curve\", FALSE)\n\n\n\n\n\n\nshow density curve\n\n\n\n\n\nCode\nsliderInput(\"bw_adjust\", label = \"Bandwidth adjustment:\",\n            min = 0.2, max = 4, value = 2, step = 0.4)\n\n\n\nBandwidth adjustment:"
  },
  {
    "objectID": "Dashboard.html#column-1",
    "href": "Dashboard.html#column-1",
    "title": "Histograms",
    "section": "Column",
    "text": "Column\n\nDistributions of Exposure and Outcome Variables\n\n\nCode\nrenderPlot({\n  if(input$density == TRUE){\n    if(input$variable==\"Sodium intake\"){\n    hist(data$DR1TSODI, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    dens &lt;- density(data$DR1TSODI, adjust = input$bw_adjust)\n    lines(dens, col = \"red\")\n    }else{\n      if(input$variable==\"Systolic Blood Pressure\"){\n    hist(data$sybp, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    dens &lt;- density(data$sybp, adjust = input$bw_adjust)\n    lines(dens, col = \"red\")\n    }else{\n      if(input$variable==\"Diastolic Blood Pressure\"){\n    hist(data$dibp, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    dens &lt;- density(data$dibp, adjust = input$bw_adjust)\n    lines(dens, col = \"red\")\n    }else{\n      \n    }\n    }\n    }\n  } else{\n    if(input$variable==\"Sodium intake\"){\n    hist(data$DR1TSODI, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    }else{\n      if(input$variable==\"Systolic Blood Pressure\"){\n    hist(data$sybp, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    }else{\n      if(input$variable==\"Diastolic Blood Pressure\"){\n    hist(data$dibp, probability = TRUE, breaks = as.numeric(input$n_breaks),\n       xlab = \"Number of Observations\", main = input$name)\n    }else{\n      \n    }\n    }\n    }\n  }\n})"
  },
  {
    "objectID": "Final_project.html#statistical-analysis-for-association-between-sodium-intake-and-blood-pressure",
    "href": "Final_project.html#statistical-analysis-for-association-between-sodium-intake-and-blood-pressure",
    "title": "Final project",
    "section": "2. Statistical Analysis for Association between Sodium Intake and Blood Pressure",
    "text": "2. Statistical Analysis for Association between Sodium Intake and Blood Pressure\n\n\nCode\n# # Ensure cleaned data is available\n# reg_data &lt;- cleaned_data %&gt;%\n#   mutate(\n#     BP_Category = case_when(\n#       sybp &lt; 90 ~ \"Low\",\n#       sybp &gt;= 90 & sybp &lt;= 130 ~ \"Normal\",\n#       sybp &gt; 130 ~ \"High\"\n#     ) %&gt;% factor(levels = c(\"Low\", \"Normal\", \"High\")), # Ordered levels\n#     BP_Binary = ifelse(sybp &gt; 130, 1, 0) # Binary for logistic regression\n#   )\n# \n# # Model 1: Linear Model (Sodium Intake and Blood Pressure)\n# model1 &lt;- lm(sybp ~ DR1TSODI, data = reg_data)\n# \n# # Model 2: Linear Model (Age, Gender, Race, Sodium Intake)\n# model2 &lt;- lm(sybp ~ DR1TSODI + RIDAGEYR + RIAGENDR + RIDRETH3, data = reg_data)\n# \n# # Model 3: Linear Model (Adding more covariates)\n# model3 &lt;- lm(sybp ~ DR1TSODI + RIDAGEYR + RIAGENDR + RIDRETH3 + BMXBMI + LBXTC + BPQ150 + DR1TKCAL, data = reg_data)\n# \n# # Model 4: Logistic Regression (Sodium Intake and Blood Pressure)\n# model4 &lt;- glm(BP_Binary ~ DR1TSODI, data = reg_data, family = binomial)\n# \n# # Model 5: Ordinal Logistic Regression (Sodium Intake and Blood Pressure)\n# model5 &lt;- polr(BP_Category ~ DR1TSODI, data = reg_data, Hess = TRUE)\n# \n# # Model 6: Ordinal Logistic Regression (Adding age, gender, race)\n# model6 &lt;- polr(BP_Category ~ DR1TSODI + RIDAGEYR + RIAGENDR + RIDRETH3, data = reg_data, Hess = TRUE)\n# \n# # Model 7: Ordinal Logistic Regression (Adding more covariates)\n# model7 &lt;- polr(BP_Category ~ DR1TSODI + RIDAGEYR + RIAGENDR + RIDRETH3 + BMXBMI + LBXTC + BPQ150 + DR1TKCAL, data = reg_data, Hess = TRUE)\n# \n# stargazer(model1, model2, model3, model4, model5, model6, model7, type = \"text\", title = \"Regression Models Summary\")"
  },
  {
    "objectID": "Final_project.html#conduct-machine-learning-programming-paradigms",
    "href": "Final_project.html#conduct-machine-learning-programming-paradigms",
    "title": "Final project",
    "section": "3. Conduct Machine Learning Programming Paradigms",
    "text": "3. Conduct Machine Learning Programming Paradigms"
  },
  {
    "objectID": "Final_project.html#using-s3-to-conduct-object-oriented-programming",
    "href": "Final_project.html#using-s3-to-conduct-object-oriented-programming",
    "title": "Final project",
    "section": "2. Using S3 to Conduct Object-Oriented Programming",
    "text": "2. Using S3 to Conduct Object-Oriented Programming\n\n2.1 Setup S3 Object for Regression Analysis\n\n\nCode\n# Define an S3 class for blood pressure analysis\nBPAnalysis &lt;- function(data) {\n  structure(\n    list(data = data, summaries = list()), # Store the dataset and summaries in the object\n    class = \"BPAnalysis\"\n  )\n}\n\n# S3 method for cleaning data - SYBP\nsybp.BPAnalysis &lt;- function(obj) {\n  obj$data &lt;- obj$data %&gt;%\n    mutate(\n      BP_Category = factor(case_when(\n        sybp &lt; 90 ~ \"Low\",\n        sybp &gt;= 90 & sybp &lt;= 130 ~ \"Normal\",\n        sybp &gt; 130 ~ \"High\"\n      ), levels = c(\"Low\", \"Normal\", \"High\")),\n      BP_Binary = ifelse(sybp &gt; 130, 1, 0)\n    )\n  obj\n}\n\n# S3 method for cleaning data - DIBP\ndibp.BPAnalysis &lt;- function(obj) {\n  obj$data &lt;- obj$data %&gt;%\n    mutate(\n      BP_Category = factor(case_when(\n        dibp &lt; 60 ~ \"Low\",\n        dibp &gt;= 60 & dibp &lt;= 80 ~ \"Normal\",\n        dibp &gt; 80 ~ \"High\"\n      ), levels = c(\"Low\", \"Normal\", \"High\")),\n      BP_Binary = ifelse(dibp &gt; 80, 1, 0)\n    )\n  obj\n}\n\n# S3 method for modeling with condition-based formulas\nmodel.BPAnalysis &lt;- function(obj, type = \"linear\", variables = c(\"DR1TSODI\"), response = \"sybp\") {\n  # Base formula\n  response &lt;- if (type == \"logistic\") \"BP_Binary\" else if (type == \"ordinal\") \"BP_Category\" else response\n  formula &lt;- as.formula(paste(response, \"~\", paste(variables, collapse = \" + \")))\n  \n  if (type == \"linear\") {\n    obj$model &lt;- lm(formula, data = obj$data)\n  } else if (type == \"logistic\") {\n    obj$model &lt;- glm(formula, data = obj$data, family = binomial)\n  } else if (type == \"ordinal\") {\n    obj$model &lt;- MASS::polr(formula, data = obj$data, Hess = TRUE)\n  } else {\n    stop(\"Invalid model type.\")\n  }\n  obj\n}\n\n# S3 method for summarizing results\nsummary.BPAnalysis &lt;- function(obj, model_description) {\n  if (is.null(obj$model)) {\n    stop(\"No model has been created yet.\")\n  }\n  obj$summaries[[model_description]] &lt;- capture.output(summary(obj$model))\n  obj\n}\n\n# Extend S3 to handle all seven models for a given response variable\nrun_models.BPAnalysis &lt;- function(obj, response = \"sybp\") {\n  models &lt;- list(\n    list(type = \"linear\", variables = c(\"DR1TSODI\"), \n         description = \"Model 1: Linear Model (Sodium Intake and Blood Pressure)\"),\n    list(type = \"linear\", \n         variables = c(\"DR1TSODI\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\"), \n         description = \"Model 2: Linear Model (Sodium Intake, Age, Gender, Race)\"),\n    list(type = \"linear\", \n         variables = c(\"DR1TSODI\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\", \n                       \"BMXBMI\", \"LBXTC\", \"BPQ150\", \"DR1TKCAL\"), \n         description = \"Model 3: Linear Model (Sodium Intake, Age, Gender, Race, BMI, Total Cholesterol, High Blood Pressure Medication, Calories Intake)\"),\n    list(type = \"logistic\", variables = c(\"DR1TSODI\"), \n         description = \"Model 4: Logistic Regression (Sodium Intake and Blood Pressure)\"),\n    list(type = \"ordinal\", variables = c(\"DR1TSODI\"), \n         description = \"Model 5: Ordinal Logistic Regression (Sodium Intake and Blood Pressure)\"),\n    list(type = \"ordinal\", \n         variables = c(\"DR1TSODI\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\"), \n         description = \"Model 6: Ordinal Logistic Regression (Sodium Intake, Age, Gender, Race)\"),\n    list(type = \"ordinal\", \n         variables = c(\"DR1TSODI\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\", \n                       \"BMXBMI\", \"LBXTC\", \"BPQ150\", \"DR1TKCAL\"), \n         description = \"Model 7: Ordinal Logistic Regression (Sodium Intake, Age, Gender, Race, BMI, Total Cholesterol, High Blood Pressure Medication, Calories Intake)\")\n  )\n\n  for (model in models) {\n    obj &lt;- model.BPAnalysis(obj, type = model$type, variables = model$variables, response = response)\n    obj &lt;- summary.BPAnalysis(obj, model$description)\n  }\n\n  obj\n}\n\n# Function to output all summaries as HTML\noutput_summaries &lt;- function(obj, output_file = \"model_summaries.html\") {\n  html_content &lt;- \"&lt;html&gt;&lt;head&gt;&lt;title&gt;Model Summaries&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Model Summaries&lt;/h1&gt;\"\n\n  for (model_name in names(obj$summaries)) {\n    html_content &lt;- paste0(\n      html_content,\n      \"&lt;h2&gt;\", model_name, \"&lt;/h2&gt;\",\n      \"&lt;pre&gt;\", paste(obj$summaries[[model_name]], collapse = \"\\n\"), \"&lt;/pre&gt;\"\n    )\n  }\n\n  html_content &lt;- paste0(html_content, \"&lt;/body&gt;&lt;/html&gt;\")\n  writeLines(html_content, output_file)\n  message(\"Summaries written to \", output_file)\n}\n\n\n\n\n2.2 Systolic Blood Pressure\n\n\nCode\n# Run SYBP analysis\nsybp_obj &lt;- BPAnalysis(cleaned_data)\nsybp_obj &lt;- sybp.BPAnalysis(sybp_obj)\nsybp_obj &lt;- run_models.BPAnalysis(sybp_obj, response = \"sybp\")\noutput_summaries(sybp_obj, output_file = \"sybp_model_summaries.html\")\n\n\nSummaries written to sybp_model_summaries.html\n\n\nView Model Summaries in sybp_model_summaries.html\n\n\n2.3 Diastolic Blood Pressure\n\n\nCode\n# Run DIBP analysis\ndibp_obj &lt;- BPAnalysis(cleaned_data)\ndibp_obj &lt;- dibp.BPAnalysis(dibp_obj)\ndibp_obj &lt;- run_models.BPAnalysis(dibp_obj, response = \"dibp\")\noutput_summaries(dibp_obj, output_file = \"dibp_model_summaries.html\")\n\n\nSummaries written to dibp_model_summaries.html\n\n\nView Model Summaries in dibp_model_summaries.html\n\n\nCode\n# Visualization 1: Distribution of Systolic Blood Pressure (sybp) by Gender\nggplot(cleaned_data, aes(x = sybp, fill = RIAGENDR)) +\n  geom_histogram(binwidth = 5, position = \"dodge\", color = \"black\") +\n  scale_fill_manual(values = c(\"#0073C2FF\", \"#EFC000FF\")) +\n  labs(\n    title = \"Distribution of Systolic Blood Pressure by Gender\",\n    x = \"Systolic Blood Pressure (mmHg)\",\n    y = \"Count\",\n    fill = \"Gender\"\n  ) +\n  theme_classic()\n\n\nWarning: Removed 4415 rows containing non-finite outside the scale range\n(`stat_bin()`).\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Visualization 2: Boxplot of Sodium Intake (DR1TSODI) by Gender\nggplot(cleaned_data, aes(x = RIAGENDR, y = DR1TSODI, fill = RIAGENDR)) +\n  geom_boxplot() +\n  scale_fill_manual(values = c(\"#0073C2FF\", \"#EFC000FF\")) +\n  labs(\n    title = \"Sodium Intake by Gender\",\n    x = \"Gender\",\n    y = \"Sodium Intake (mg)\"\n  ) +\n  theme_classic()\n\n\nWarning: Removed 5239 rows containing non-finite outside the scale range\n(`stat_boxplot()`).\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Visualization 3: Relationship between BMI (BMXBMI) and Systolic Blood Pressure (sybp)\nggplot(cleaned_data, aes(x = BMXBMI, y = sybp, color = RIDRETH3)) +\n  geom_point(alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"black\") +\n  scale_color_manual(values = c(\"#E41A1C\", \"#377EB8\", \"#4DAF4A\", \"#FF7F00\", \"#984EA3\")) +\n  labs(\n    title = \"Relationship between BMI and Systolic Blood Pressure by Race\",\n    x = \"Body Mass Index (kg/m²)\",\n    y = \"Systolic Blood Pressure (mmHg)\",\n    color = \"Race\"\n  ) +\n  theme_minimal()\n\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 4480 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 4480 rows containing missing values or values outside the scale range\n(`geom_point()`)."
  },
  {
    "objectID": "1111.html",
    "href": "1111.html",
    "title": "Final project",
    "section": "",
    "text": "Yishan Lin: JHED ID: ylin183; Email: ylin183@jh.edu\nYingqi Wang: JHED ID: ywang911; Email: ywang911@jh.edu\nYiming Ding: JHED ID: yding75; Email: yding75@jh.edu\nRuiqing Cai: JHED ID: rcai9; Email: rcai9@jh.edu"
  },
  {
    "objectID": "1111.html#authors-information",
    "href": "1111.html#authors-information",
    "title": "Final project",
    "section": "",
    "text": "Yishan Lin: JHED ID: ylin183; Email: ylin183@jh.edu\nYingqi Wang: JHED ID: ywang911; Email: ywang911@jh.edu\nYiming Ding: JHED ID: yding75; Email: yding75@jh.edu\nRuiqing Cai: JHED ID: rcai9; Email: rcai9@jh.edu"
  },
  {
    "objectID": "1111.html#data-preparation-and-robust-analysis",
    "href": "1111.html#data-preparation-and-robust-analysis",
    "title": "Final project",
    "section": "1. Data Preparation and Robust Analysis",
    "text": "1. Data Preparation and Robust Analysis\n\n\n\n\n\n\nNote\n\n\n\nIn this section, data downloading, processing, and some initial analysis were conducted by using the “functional Programming” Paradigms\n\n\n\n1.1 Download and Initial Cleaning\nData are directly downloaded from the CDC websites. For more information see the code\n\n\nCode\n# Create a folder to store all the data\nif (!dir.exists(\"data\")) { # check if folder already exists\n  dir.create(\"data\")\n}\n\n# Setup function to download the data\ndownload_and_save &lt;- function(url, filename) {\n  filepath &lt;- file.path(\"data\", filename)\n  \n  if (!file.exists(filepath)) { # Check if file already exists\n    message(paste(\"Downloading\", filename, \"...\"))\n    dataset &lt;- read_xpt(url)\n    saveRDS(dataset, filepath)\n  } else {\n    message(paste(filename, \"already exists. Loading from cache.\"))\n  }\n  \n  readRDS(filepath) # Load the dataset\n}\n \n# Function to clean individual datasets\nclean_dataset &lt;- function(data, vars) {\n  data %&gt;% dplyr::select(all_of(vars))\n}\n\n# Selecting data\ndatasets &lt;- list(\n  demo = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DEMO_L.xpt\",\n    file = \"demo_data.rds\",\n    vars = c(\"SEQN\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\")\n  ),\n  diet = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DR1TOT_L.xpt\",\n    file = \"diet_data.rds\",\n    vars = c(\"SEQN\", \"DR1TPOTA\", \"DR1TKCAL\")\n  ),\n  bp = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BPXO_L.xpt\",\n    file = \"bp_data.rds\",\n    vars = c(\"SEQN\", \"BPXOSY1\", \"BPXOSY2\", \"BPXOSY3\", \"BPXODI1\", \"BPXODI2\", \"BPXODI3\")\n  ),\n  body = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BMX_L.xpt\",\n    file = \"body_data.rds\",\n    vars = c(\"SEQN\", \"BMXBMI\")\n  ),\n  lab = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/TCHOL_L.xpt\",\n    file = \"lab_data.rds\",\n    vars = c(\"SEQN\", \"LBXTC\")\n  ),\n  ques = list(\n    url = \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BPQ_L.xpt\",\n    file = \"ques_data.rds\",\n    vars = c(\"SEQN\", \"BPQ150\")\n  )\n)\n\n# Downloading, saving, and cleaning datasets\nnhanes_data &lt;- purrr::map(datasets, function(info) {\n  raw_data &lt;- download_and_save(info$url, info$file)\n  clean_dataset(raw_data, info$vars)\n})\n\n# Merging into single dataframe\nmerged_data &lt;- purrr::reduce(nhanes_data, dplyr::left_join, by = \"SEQN\")\n\n\n\n\n1.2 Process and Table 1\nTable 1: Characteristics of Study Participants from August 2021 to August 2023\n\n\nCode\n# Function to preprocess data\nprocess_data &lt;- function(data) {\n  data %&gt;%\n    dplyr::mutate(\n      RIAGENDR = dplyr::recode_factor(RIAGENDR, `1` = \"Male\", `2` = \"Female\"),\n      RIDRETH3 = dplyr::recode_factor(\n        RIDRETH3,\n        `1` = \"Mexican American\",\n        `2` = \"Other Hispanic\",\n        `3` = \"Non-Hispanic White\",\n        `4` = \"Non-Hispanic Black\",\n        `6` = \"Other\"\n      ),\n      BPQ150 = dplyr::recode_factor(BPQ150, `1` = \"Yes\", `2` = \"No\"),\n      sybp = rowMeans(dplyr::select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),\n      dibp = rowMeans(dplyr::select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)\n    )\n}\n\n# Create Table 1 function\ncreate_table1 &lt;- function(data) {\n  table1(~ RIDAGEYR + RIAGENDR + RIDRETH3 + DR1TPOTA + BMXBMI + sybp + dibp + \n           BPQ150, data = data)\n}\n\n# Labeling data\nset_labels_and_units &lt;- function(data, labels, units = NULL) {\n  for (var in names(labels)) {\n    label(data[[var]]) &lt;- labels[[var]]\n  }\n  if (!is.null(units)) {\n    for (var in names(units)) {\n      units(data[[var]]) &lt;- units[[var]]\n    }\n  }\n  return(data)\n}\n\n## Define labels and units as named lists\nlabels &lt;- list(\n  RIDAGEYR = \"Age at Screening\",\n  RIAGENDR = \"Gender\",\n  RIDRETH3 = \"Race\",\n  BPQ150 = \"High Blood Pressure Medication\",\n  sybp = \"Systolic Blood Pressure\",\n  dibp = \"Diastolic Blood Pressure\",\n  BMXBMI = \"Body Mass Index\"\n)\n\nunits &lt;- list(\n  RIDAGEYR = \"Year\",\n  sybp = \"mmHg\",\n  dibp = \"mmHg\",\n  BMXBMI = \"kg/m\\u00B2\"\n)\n\n# Apply the data processing function\ncleaned_data &lt;- process_data(merged_data)\n\n# Apply labels and units\ncleaned_data &lt;- set_labels_and_units(cleaned_data, labels, units)\n\n# Generate Table 1\ncreate_table1(cleaned_data)\n\n\n\n\n\n\n\n\n\n\n\nOverall\n(N=11933)\n\n\n\n\nAge at Screening (Year)\n\n\n\nMean (SD)\n38.3 (25.6)\n\n\nMedian [Min, Max]\n37.0 [0, 80.0]\n\n\nGender\n\n\n\nMale\n5575 (46.7%)\n\n\nFemale\n6358 (53.3%)\n\n\nRace\n\n\n\nMexican American\n1117 (9.4%)\n\n\nOther Hispanic\n1373 (11.5%)\n\n\nNon-Hispanic White\n6217 (52.1%)\n\n\nNon-Hispanic Black\n1597 (13.4%)\n\n\nOther\n681 (5.7%)\n\n\nMissing\n948 (7.9%)\n\n\nPotassium (mg)\n\n\n\nMean (SD)\n2340 (1230)\n\n\nMedian [Min, Max]\n2150 [0, 14300]\n\n\nMissing\n5239 (43.9%)\n\n\nBody Mass Index (kg/m²)\n\n\n\nMean (SD)\n27.2 (8.14)\n\n\nMedian [Min, Max]\n26.4 [11.1, 74.8]\n\n\nMissing\n3462 (29.0%)\n\n\nSystolic Blood Pressure (mmHg)\n\n\n\nMean (SD)\n119 (18.2)\n\n\nMedian [Min, Max]\n116 [70.0, 232]\n\n\nMissing\n4415 (37.0%)\n\n\nDiastolic Blood Pressure (mmHg)\n\n\n\nMean (SD)\n72.2 (11.5)\n\n\nMedian [Min, Max]\n71.7 [34.0, 139]\n\n\nMissing\n4415 (37.0%)\n\n\nHigh Blood Pressure Medication\n\n\n\nYes\n2442 (20.5%)\n\n\nNo\n523 (4.4%)\n\n\nMissing\n8968 (75.2%)\n\n\n\n\n\n\n\nCode\n# Save cleaned data\nreadr::write_csv(cleaned_data, \"data/NHANES_cleaned_data.csv\")\n\n\n\n\n1.3 Robust Anlysis\nA stratified Analysis by gender was conducted.\n\n\nCode\n# Stratification function setup\nstratified_analysis &lt;- function(data, group_var, analysis_func) {\n  # Split data into groups\n  split_data &lt;- split(data, data[[group_var]])\n  \n  # Apply the analysis function and add group label\n  summary_list &lt;- map(split_data, ~ {\n    analysis_func(.x) %&gt;%\n      mutate(Gender = unique(.x[[group_var]])) # Add group label\n  })\n  \n  # Combine all group summaries into a single table\n  combined_summary &lt;- bind_rows(summary_list)\n  \n  # Return combined table\n  combined_summary\n}\n\nsummarize_data &lt;- function(data) {\n  data %&gt;%\n    summarize(\n      mean_age = mean(RIDAGEYR, na.rm = TRUE),\n      mean_sodium = mean(DR1TPOTA, na.rm = TRUE),\n      mean_sbp = mean(sybp, na.rm = TRUE),\n      mean_dbp = mean(dibp, na.rm = TRUE),\n      n = n()\n    )\n}\n\n# stratified analysis by gender\nstratified_summary &lt;- stratified_analysis(cleaned_data, \"RIAGENDR\", summarize_data)\nknitr::kable(stratified_summary, \n      caption = \"Table 2: Summary of each variables stratified by gender\", \n      format = \"html\")\n\n\n\nTable 2: Summary of each variables stratified by gender\n\n\nmean_age\nmean_sodium\nmean_sbp\nmean_dbp\nn\nGender\n\n\n\n\n37.12323\n2602.813\n121.2114\n72.55017\n5575\nMale\n\n\n39.36537\n2126.442\n117.2749\n71.91256\n6358\nFemale"
  },
  {
    "objectID": "1111.html#using-s3-to-conduct-object-oriented-programming",
    "href": "1111.html#using-s3-to-conduct-object-oriented-programming",
    "title": "Final project",
    "section": "2. Using S3 to Conduct Object-Oriented Programming",
    "text": "2. Using S3 to Conduct Object-Oriented Programming\n\n\nCode\n# Extend the S3 methods to cover all seven models\n\n# Define an S3 class for blood pressure analysis\nBPAnalysis &lt;- function(data) {\n  structure(\n    list(data = data, summaries = list()), # Store the dataset and summaries in the object\n    class = \"BPAnalysis\"\n  )\n}\n\n# S3 method for cleaning data\nclean.BPAnalysis &lt;- function(obj) {\n  obj$data &lt;- obj$data %&gt;%\n    mutate(\n      BP_Category = case_when(\n        sybp &lt; 90 ~ \"Low\",\n        sybp &gt;= 90 & sybp &lt;= 130 ~ \"Normal\",\n        sybp &gt; 130 ~ \"High\"\n      ) %&gt;% factor(levels = c(\"Low\", \"Normal\", \"High\")),\n      BP_Binary = ifelse(sybp &gt; 130, 1, 0)\n    )\n  obj\n}\n\n# S3 method for modeling with condition-based formulas\nmodel.BPAnalysis &lt;- function(obj, type = \"linear\", variables = c(\"DR1TPOTA\")) {\n  # Base formula\n  response &lt;- if (type == \"logistic\") \"BP_Binary\" else if (type == \"ordinal\") \"BP_Category\" else \"sybp\"\n  formula &lt;- as.formula(paste(response, \"~\", paste(variables, collapse = \" + \")))\n\n  if (type == \"linear\") {\n    obj$model &lt;- lm(formula, data = obj$data)\n  } else if (type == \"logistic\") {\n    obj$model &lt;- glm(formula, data = obj$data, family = binomial)\n  } else if (type == \"ordinal\") {\n    obj$model &lt;- MASS::polr(formula, data = obj$data, Hess = TRUE)\n  } else {\n    stop(\"Invalid model type.\")\n  }\n  obj\n}\n\n# S3 method for summarizing results\nsummary.BPAnalysis &lt;- function(obj, model_description) {\n  if (is.null(obj$model)) {\n    stop(\"No model has been created yet.\")\n  }\n  summary_text &lt;- capture.output(summary(obj$model))\n  obj$summaries[[model_description]] &lt;- summary_text\n  obj\n}\n\n# Extend S3 to handle all seven models using conditions\nrun_models.BPAnalysis &lt;- function(obj) {\n  models &lt;- list(\n    list(type = \"linear\", variables = c(\"DR1TPOTA\"), description = \"Model 1: Linear Model (Sodium Intake and Blood Pressure)\"),\n    list(type = \"linear\", variables = c(\"DR1TPOTA\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\"), description = \"Model 2: Linear Model (Sodium Intake, Age, Gender, Race)\"),\n    list(type = \"linear\", variables = c(\"DR1TPOTA\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\", \"BMXBMI\", \"LBXTC\", \"BPQ150\", \"DR1TKCAL\"), description = \"Model 3: Linear Model (Sodium Intake, Age, Gender, Race, BMI, Total Cholesterol, High Blood Pressure Medication, Calories Intake)\"),\n    list(type = \"logistic\", variables = c(\"DR1TPOTA\"), description = \"Model 4: Logistic Regression (Sodium Intake and Blood Pressure)\"),\n    list(type = \"ordinal\", variables = c(\"DR1TPOTA\"), description = \"Model 5: Ordinal Logistic Regression (Sodium Intake and Blood Pressure)\"),\n    list(type = \"ordinal\", variables = c(\"DR1TPOTA\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\"), description = \"Model 6: Ordinal Logistic Regression (Sodium Intake, Age, Gender, Race)\"),\n    list(type = \"ordinal\", variables = c(\"DR1TPOTA\", \"RIDAGEYR\", \"RIAGENDR\", \"RIDRETH3\", \"BMXBMI\", \"LBXTC\", \"BPQ150\", \"DR1TKCAL\"), description = \"Model 7: Ordinal Logistic Regression (Sodium Intake, Age, Gender, Race, BMI, Total Cholesterol, High Blood Pressure Medication, Calories Intake)\")\n  )\n\n  for (model in models) {\n    obj &lt;- model.BPAnalysis(obj, type = model$type, variables = model$variables)\n    obj &lt;- summary.BPAnalysis(obj, model$description)\n  }\n\n  obj\n}\n\n# Function to output all summaries as HTML\noutput_summaries &lt;- function(obj, output_file = \"model_summaries.html\") {\n  html_content &lt;- \"&lt;html&gt;&lt;head&gt;&lt;title&gt;Model Summaries&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Model Summaries&lt;/h1&gt;\"\n\n  for (model_name in names(obj$summaries)) {\n    html_content &lt;- paste0(\n      html_content,\n      \"&lt;h2&gt;\", model_name, \"&lt;/h2&gt;\",\n      \"&lt;pre&gt;\", paste(obj$summaries[[model_name]], collapse = \"\\n\"), \"&lt;/pre&gt;\"\n    )\n  }\n\n  html_content &lt;- paste0(html_content, \"&lt;/body&gt;&lt;/html&gt;\")\n  writeLines(html_content, output_file)\n  message(\"Summaries written to \", output_file)\n}\n\n# Create an S3 object and run all models\nbp_obj &lt;- BPAnalysis(cleaned_data)\nbp_obj &lt;- clean.BPAnalysis(bp_obj)\nbp_obj &lt;- run_models.BPAnalysis(bp_obj)\n\n# Output summaries to an HTML file\noutput_summaries(bp_obj)\n\n\nSummaries written to model_summaries.html\n\n\nView Model Summaries in model_summaries.html\n\n\nCode\n# Visualization 1: Distribution of Systolic Blood Pressure (sybp) by Gender\nggplot(cleaned_data, aes(x = sybp, fill = RIAGENDR)) +\n  geom_histogram(binwidth = 5, position = \"dodge\", color = \"black\") +\n  scale_fill_manual(values = c(\"#0073C2FF\", \"#EFC000FF\")) +\n  labs(\n    title = \"Distribution of Systolic Blood Pressure by Gender\",\n    x = \"Systolic Blood Pressure (mmHg)\",\n    y = \"Count\",\n    fill = \"Gender\"\n  ) +\n  theme_classic()\n\n\nWarning: Removed 4415 rows containing non-finite outside the scale range\n(`stat_bin()`).\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Visualization 2: Boxplot of Sodium Intake (DR1TPOTA) by Gender\nggplot(cleaned_data, aes(x = RIAGENDR, y = DR1TPOTA, fill = RIAGENDR)) +\n  geom_boxplot() +\n  scale_fill_manual(values = c(\"#0073C2FF\", \"#EFC000FF\")) +\n  labs(\n    title = \"Sodium Intake by Gender\",\n    x = \"Gender\",\n    y = \"Sodium Intake (mg)\"\n  ) +\n  theme_classic()\n\n\nWarning: Removed 5239 rows containing non-finite outside the scale range\n(`stat_boxplot()`).\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Visualization 3: Relationship between BMI (BMXBMI) and Systolic Blood Pressure (sybp)\nggplot(cleaned_data, aes(x = BMXBMI, y = sybp, color = RIDRETH3)) +\n  geom_point(alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"black\") +\n  scale_color_manual(values = c(\"#E41A1C\", \"#377EB8\", \"#4DAF4A\", \"#FF7F00\", \"#984EA3\")) +\n  labs(\n    title = \"Relationship between BMI and Systolic Blood Pressure by Race\",\n    x = \"Body Mass Index (kg/m²)\",\n    y = \"Systolic Blood Pressure (mmHg)\",\n    color = \"Race\"\n  ) +\n  theme_minimal()\n\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 4480 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 4480 rows containing missing values or values outside the scale range\n(`geom_point()`)."
  }
]